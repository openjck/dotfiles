#!/usr/bin/env bash

# Install the dependencies of the main setup script, then run it.
#
# This script therefore functions like a bootstrap script.
#
# The main setup script is written in Python. The Python tool "uv" is used to
# ensure that the correct version of Python is installed, as well as all Python
# packages that the script depends on. For that reason, uv must be installed
# before running the script. This script installs uv.
#
# The main setup script installs docopts, so docopts is not used in this script
# itself.

# Use "strict mode."
#
# http://redsymbol.net/articles/unofficial-bash-strict-mode/
set -euo pipefail

function os_is_debian_based() {
  [[ -f /etc/debian_version ]]
}

if ! os_is_debian_based; then
  >&2 echo 'FATAL ERROR: This distro is not supported.'
  exit 1
fi

if ! sudo -v; then
  >&2 echo "FATAL ERROR: \"sudo\" must be installed and enabled for \"$USER\"."
  exit 1
fi

# Install pip if it's not already installed.
#
# pip is needed to install uv, and uv is needed to run the setup script.
if ! command -v pip > /dev/null; then
  if os_is_debian_based; then
    sudo apt-get install --assume-yes pipx
  fi
fi

if ! command -v uv > /dev/null; then
  pipx install uv
fi

"$HOME"/bin/personal/vcsh/dotfiles-openjck-setup-main/dotfiles-openjck-setup-main.py
