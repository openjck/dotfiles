#!/usr/bin/env bash

function set_up_vcsh() {
  local MODIFIED_CONFIG=false

  if [[ $(vcsh dotfiles-openjck config status.showUntrackedFiles) != 'no' ]]; then
    vcsh dotfiles-openjck config status.showUntrackedFiles no
    MODIFIED_CONFIG=true
  fi

  if [[ $(vcsh dotfiles-openjck config core.sparseCheckout) != 'true' ]]; then
    vcsh dotfiles-openjck config core.sparseCheckout true
    MODIFIED_CONFIG=true
  fi

  local SC_CONTENTS="*
!/README.md
!/LICENSE
!/docs/**"

  local SC_FILE=$XDG_CONFIG_HOME/vcsh/repo.d/dotfiles-openjck.git/info/sparse-checkout

  if [[ ! -f "$SC_FILE" || ($(cat "$SC_FILE") != "$SC_CONTENTS") ]]; then
    echo "$SC_CONTENTS" > "$SC_FILE"
    MODIFIED_CONFIG=true
  fi

  if [[ $MODIFIED_CONFIG == true ]]; then
    vcsh dotfiles-openjck checkout --quiet
    return $RETURN_CODE_DONE
  else
    return $RETURN_CODE_ALREADY_DONE
  fi
}
